import formatResult from "../result";
import Loader from "./Loader";
import { useState } from "react";
import Donut from "./Donut";

const Dump = () => {
  const [resultDiv, setResultDiv] = useState("");
  const main = async (e) => {
    e.preventDefault();
    const input = document.querySelector(".file-input");
    input.style.display = "none";
    const loader = document.querySelector(".loader");
    loader.style.display = "block";
    let result;
    try {
      const file = document.getElementById("fileInput").files;
      console.log("Fetching data from memory dump....");
      await window.api.processdump(file[0].path);
      console.log("Running through the csv maker....");
      await window.api.customfile();
      console.log("Done preparing csv as input");
      result = await window.api.testmodel();
      console.log("Areeb top",result);
      const data = [
        {
          title: "Benign",
          value: result.Begnign,
        },
        {
          title: "Ransomware",
          value: result.Ransomware,
        },
        {
          title: "Spyware",
          value: result.Spyware,
        },
        {
          title: "Trojan",
          value: result.Trojan,
        },
      ];
      setResultDiv(<Donut data={data} detail="Probability" />);
      input.style.display = "block";
      loader.style.display = "none";
      console.log("done model test");
    } catch (error) {
      console.error(error);
    }
  };
  return (
    <div className="dump">
      <div className="file-input">
        <h3>Input files in .mem or .dmp</h3>
        <div className="ring">
          <i></i>
          <i></i>
          <i></i>
          <form id="fileForm" onSubmit={main}>
            <div className="login">
              <h3>Give Memory Dump File</h3>
              <div className="inputBx">
                <input
                  type="file"
                  id="fileInput"
                  name="fileInput"
                  // accept=".mem"
                />
              </div>
              <button type="submit">Submit</button>
            </div>
          </form>
        </div>
      </div>
      <Loader />
      <div className="result">{resultDiv}</div>
    </div>
  );
};

export default Dump;
